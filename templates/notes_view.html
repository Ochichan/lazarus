{% extends "base.html" %}
{% block nav_notes %}{{ t["nav.notes"] }}{% endblock %}
{% block nav_search %}{{ t["nav.search"] }}{% endblock %}
{% block nav_wiki %}{{ t["nav.wiki"] }}{% endblock %}
{% block version %}{{ version }}{% endblock %}
{% block title %}{{ note.title }} - Lazarus{% endblock %}
{% block content %}
<article class="note-view">
    <header class="note-header">
        <h1>{{ note.title }}</h1>
        <div class="note-meta">
            <time>{{ t["notes.created"] }}: {{ note.created_at }}</time>
            <time>{{ t["notes.updated"] }}: {{ note.updated_at }}</time>
        </div>
        {% if !note.tags.is_empty() %}
        <div class="note-tags">
            {% for tag in note.tags %}
            <span class="tag">{{ tag }}</span>
            {% endfor %}
        </div>
        {% endif %}
    </header>
    <div class="note-content">
        {{ note.content }}
    </div>
    <footer class="note-actions">
        <a href="/notes/{{ note.id }}/edit" class="btn">‚úèÔ∏è {{ t["notes.edit"] }}</a>
        <button class="btn btn-accent" id="extract-cards" data-note-id="{{ note.id }}">
            üß† {{ t["srs.create_cards"] }}
        </button>
        <button
            class="btn btn-danger"
            hx-delete="/api/notes/{{ note.id }}"
            hx-confirm="{{ t["notes.delete_confirm"] }}"
        >üóëÔ∏è {{ t["notes.delete"] }}</button>
    </footer>
</article>

<!-- Ïñ∏Ïñ¥ ÏÑ†ÌÉù -->
<section class="lang-selector">
    <form action="/api/lang" method="post" style="display: inline;">
        <button type="submit" name="lang" value="en" class="btn btn-sm {% if lang == "en" %}btn-primary{% else %}btn-secondary{% endif %}">EN</button>
        <button type="submit" name="lang" value="ko" class="btn btn-sm {% if lang == "ko" %}btn-primary{% else %}btn-secondary{% endif %}">ÌïúÍµ≠Ïñ¥</button>
    </form>
</section>

<style>
.note-view {
    max-width: 800px;
    margin: 0 auto;
}
.note-header {
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--border);
}
.note-header h1 {
    margin-bottom: 0.5rem;
}
.note-meta {
    color: var(--text-secondary);
    font-size: 0.9rem;
    display: flex;
    gap: 1rem;
}
.note-tags {
    margin-top: 1rem;
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}
.tag {
    background: var(--bg-secondary);
    padding: 0.25rem 0.75rem;
    border-radius: 1rem;
    font-size: 0.875rem;
}
.note-content {
    line-height: 1.8;
    white-space: pre-wrap;
}
.note-actions {
    margin-top: 2rem;
    padding-top: 1rem;
    border-top: 1px solid var(--border);
    display: flex;
    gap: 0.5rem;
}
.lang-selector {
    position: fixed;
    bottom: 1rem;
    right: 1rem;
}
.btn-sm {
    padding: 0.25rem 0.75rem;
    font-size: 0.875rem;
}
</style>

<script>
document.getElementById('extract-cards')?.addEventListener('click', async (e) => {
    const noteId = e.target.dataset.noteId;
    const res = await fetch(`/api/srs/extract/${noteId}`, { method: 'POST' });
    const data = await res.json();
    if (data.extracted > 0) {
        alert(`${data.extracted} {{ t["srs.cards_created"] }}`);
    } else {
        alert('{{ t["srs.no_cards_extracted"] }}');
    }
});
</script>
{% endblock %}
